<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ファミマ行脚</title>
<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
<style>
html, body, #map { margin:0; height:100%; width:100%; }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
<script>
const map = new maplibregl.Map({
  container: 'map',
  center: [139.7, 35.6],
  zoom: 6,
  style: {
    version: 8,
    glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
    sources: {
      osm: {
        type: 'raster',
        tiles: [
          'https://tile.openstreetmap.org/{z}/{x}/{y}.png'
        ],
        tileSize: 256
      }
    },
    layers: [
      {
        id: 'osm',
        type: 'raster',
        source: 'osm'
      }
    ]
  }
});

map.on('load', () => {
  map.addSource('points', {
    type: 'geojson',
    data: 'spots.geojson'
  });

  map.addLayer({
    id: 'points-circle',
    type: 'circle',
    source: 'points',
    paint: {
    'circle-radius': [
      'interpolate', ['linear'], ['zoom'],
      5, 10,
      10, 14,
      15, 18
      ],
    'circle-color': '#1e8e3e',      // Google系グリーン
    'circle-stroke-color': '#ffffff',
    'circle-stroke-width': 1.5
    }
  });
  
  map.addLayer({
    id: 'points-number',
    type: 'symbol',
    source: 'points',
    layout: {
    'text-field': ['to-string', ['get', 'no']],
    'text-size': [
      'interpolate', ['linear'], ['zoom'],
      5, 9,
      10, 11,
      15, 13
    ],
    'text-font': ['Open Sans Semibold'],
    'text-anchor': 'center',
    'icon-allow-overlap': true,
    'text-allow-overlap': true
    },
    paint: {
    'text-color': '#ffffff',
    'text-halo-color': 'rgba(0,0,0,0.25)',
    'text-halo-width': 1
    }
    
  });
  
  map.addLayer({
    id: 'points-circle-outline',
    type: 'circle',
    source: 'points',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        5, 12,
        10, 16
      ],
      'circle-color': '#ffffff'
    }
  });

  map.addLayer({
    id: 'points-circle',
    type: 'circle',
    source: 'points',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        5, 10,
        10, 14
      ],
      'circle-color': '#1e8e3e'   // Google系グリーン
    }
  });
  
  map.on('click', 'points-number', (e) => {
    const f = e.features[0];
    
    const title =
    (f.properties.rename && f.properties.rename.trim() !== '')
    ? `${f.properties.name}<br>→ ${f.properties.rename}`
    : (f.properties.name || '');
    
    const html = `
      <div style="font-size:13px; line-height:1.4;">
        <b>${f.properties.no}</b><br>
        ${title}<br>
        ${f.properties.address || ''}
      </div>
    `;
  
    new maplibregl.Popup({ offset: 12 })
      .setLngLat(f.geometry.coordinates)
      .setHTML(html)
      .addTo(map);
  });
  map.on('mouseenter', 'points-number', () => {
    map.getCanvas().style.cursor = 'pointer';
  });
  
  map.on('mouseleave', 'points-number', () => {
    map.getCanvas().style.cursor = '';
  });
  
});


</script>
</body>
</html>
